{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.assertIsStringOrUndefined = exports.assertIsNumber = exports.assertIsString = exports.assertDefined = exports.thirtyDaysFromNow = exports.isRunningInWSL = exports.isCloudEnvironment = exports.datetimeString = exports.createDestroyer = exports.promiseWithSpinner = exports.setupLoggers = exports.tryParse = exports.tryStringify = exports.promiseProps = exports.promiseWhile = exports.promiseAllSettled = exports.getFunctionsEventProvider = exports.endpoint = exports.makeActiveProject = exports.streamToString = exports.stringToStream = exports.explainStdin = exports.allSettled = exports.reject = exports.logLabeledWarning = exports.logWarning = exports.logLabeledBullet = exports.logBullet = exports.logLabeledSuccess = exports.logSuccess = exports.addSubdomain = exports.addDatabaseNamespace = exports.getDatabaseViewDataUrl = exports.getDatabaseUrl = exports.envOverride = exports.getInheritedOption = exports.consoleUrl = exports.envOverrides = void 0;\n\nconst _ = require(\"lodash\");\n\nconst url = require(\"url\");\n\nconst clc = require(\"cli-color\");\n\nconst ora = require(\"ora\");\n\nconst process = require(\"process\");\n\nconst stream_1 = require(\"stream\");\n\nconst winston = require(\"winston\");\n\nconst triple_beam_1 = require(\"triple-beam\");\n\nconst assert_1 = require(\"assert\");\n\nconst ansiStrip = require(\"cli-color/strip\");\n\nconst configstore_1 = require(\"./configstore\");\n\nconst error_1 = require(\"./error\");\n\nconst logger_1 = require(\"./logger\");\n\nconst IS_WINDOWS = process.platform === \"win32\";\nconst SUCCESS_CHAR = IS_WINDOWS ? \"+\" : \"✔\";\nconst WARNING_CHAR = IS_WINDOWS ? \"!\" : \"⚠\";\nconst THIRTY_DAYS_IN_MILLISECONDS = 30 * 24 * 60 * 60 * 1000;\nexports.envOverrides = [];\n\nfunction consoleUrl(project, path) {\n  const api = require(\"./api\");\n\n  return `${api.consoleOrigin}/project/${project}${path}`;\n}\n\nexports.consoleUrl = consoleUrl;\n\nfunction getInheritedOption(options, key) {\n  let target = options;\n\n  while (target) {\n    if (_.has(target, key)) {\n      return target[key];\n    }\n\n    target = target.parent;\n  }\n}\n\nexports.getInheritedOption = getInheritedOption;\n\nfunction envOverride(envname, value, coerce) {\n  const currentEnvValue = process.env[envname];\n\n  if (currentEnvValue && currentEnvValue.length) {\n    exports.envOverrides.push(envname);\n\n    if (coerce) {\n      try {\n        return coerce(currentEnvValue, value);\n      } catch (e) {\n        return value;\n      }\n    }\n\n    return currentEnvValue;\n  }\n\n  return value;\n}\n\nexports.envOverride = envOverride;\n\nfunction getDatabaseUrl(origin, namespace, pathname) {\n  const withPath = url.resolve(origin, pathname);\n  return addDatabaseNamespace(withPath, namespace);\n}\n\nexports.getDatabaseUrl = getDatabaseUrl;\n\nfunction getDatabaseViewDataUrl(origin, project, namespace, pathname) {\n  const urlObj = new url.URL(origin);\n\n  if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n    return consoleUrl(project, `/database/${namespace}/data${pathname}`);\n  }\n\n  return getDatabaseUrl(origin, namespace, pathname + \".json\");\n}\n\nexports.getDatabaseViewDataUrl = getDatabaseViewDataUrl;\n\nfunction addDatabaseNamespace(origin, namespace) {\n  const urlObj = new url.URL(origin);\n\n  if (urlObj.hostname.includes(namespace)) {\n    return urlObj.href;\n  }\n\n  if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n    return addSubdomain(origin, namespace);\n  }\n\n  urlObj.searchParams.set(\"ns\", namespace);\n  return urlObj.href;\n}\n\nexports.addDatabaseNamespace = addDatabaseNamespace;\n\nfunction addSubdomain(origin, subdomain) {\n  return origin.replace(\"//\", `//${subdomain}.`);\n}\n\nexports.addSubdomain = addSubdomain;\n\nfunction logSuccess(message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR} `), message, data);\n}\n\nexports.logSuccess = logSuccess;\n\nfunction logLabeledSuccess(label, message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR}  ${label}:`), message, data);\n}\n\nexports.logLabeledSuccess = logLabeledSuccess;\n\nfunction logBullet(message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.cyan.bold(\"i \"), message, data);\n}\n\nexports.logBullet = logBullet;\n\nfunction logLabeledBullet(label, message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.cyan.bold(`i  ${label}:`), message, data);\n}\n\nexports.logLabeledBullet = logLabeledBullet;\n\nfunction logWarning(message, type = \"warn\", data = undefined) {\n  logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR} `), message, data);\n}\n\nexports.logWarning = logWarning;\n\nfunction logLabeledWarning(label, message, type = \"warn\", data = undefined) {\n  logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR}  ${label}:`), message, data);\n}\n\nexports.logLabeledWarning = logLabeledWarning;\n\nfunction reject(message, options) {\n  return Promise.reject(new error_1.FirebaseError(message, options));\n}\n\nexports.reject = reject;\n\nfunction allSettled(promises) {\n  if (!promises.length) {\n    return Promise.resolve([]);\n  }\n\n  return new Promise(resolve => {\n    let remaining = promises.length;\n    const results = [];\n\n    for (let i = 0; i < promises.length; i++) {\n      void Promise.resolve(promises[i]).then(result => {\n        results[i] = {\n          status: \"fulfilled\",\n          value: result\n        };\n      }, err => {\n        results[i] = {\n          status: \"rejected\",\n          reason: err\n        };\n      }).then(() => {\n        if (! --remaining) {\n          resolve(results);\n        }\n      });\n    }\n  });\n}\n\nexports.allSettled = allSettled;\n\nfunction explainStdin() {\n  if (IS_WINDOWS) {\n    throw new error_1.FirebaseError(\"STDIN input is not available on Windows.\", {\n      exit: 1\n    });\n  }\n\n  if (process.stdin.isTTY) {\n    logger_1.logger.info(clc.bold(\"Note:\"), \"Reading STDIN. Type JSON data and then press Ctrl-D\");\n  }\n}\n\nexports.explainStdin = explainStdin;\n\nfunction stringToStream(text) {\n  if (!text) {\n    return undefined;\n  }\n\n  const s = new stream_1.Readable();\n  s.push(text);\n  s.push(null);\n  return s;\n}\n\nexports.stringToStream = stringToStream;\n\nfunction streamToString(s) {\n  return new Promise((resolve, reject) => {\n    let b = \"\";\n    s.on(\"error\", reject);\n    s.on(\"data\", d => b += `${d}`);\n    s.once(\"end\", () => resolve(b));\n  });\n}\n\nexports.streamToString = streamToString;\n\nfunction makeActiveProject(projectDir, newActive) {\n  const activeProjects = configstore_1.configstore.get(\"activeProjects\") || {};\n\n  if (newActive) {\n    activeProjects[projectDir] = newActive;\n  } else {\n    _.unset(activeProjects, projectDir);\n  }\n\n  configstore_1.configstore.set(\"activeProjects\", activeProjects);\n}\n\nexports.makeActiveProject = makeActiveProject;\n\nfunction endpoint(parts) {\n  return `/${_.join(parts, \"/\")}`;\n}\n\nexports.endpoint = endpoint;\n\nfunction getFunctionsEventProvider(eventType) {\n  const parts = eventType.split(\"/\");\n\n  if (parts.length > 1) {\n    const provider = _.last(parts[1].split(\".\"));\n\n    return _.capitalize(provider);\n  }\n\n  if (eventType.match(/google.pubsub/)) {\n    return \"PubSub\";\n  } else if (eventType.match(/google.storage/)) {\n    return \"Storage\";\n  } else if (eventType.match(/google.analytics/)) {\n    return \"Analytics\";\n  } else if (eventType.match(/google.firebase.database/)) {\n    return \"Database\";\n  } else if (eventType.match(/google.firebase.auth/)) {\n    return \"Auth\";\n  } else if (eventType.match(/google.firebase.crashlytics/)) {\n    return \"Crashlytics\";\n  } else if (eventType.match(/google.firestore/)) {\n    return \"Firestore\";\n  }\n\n  return _.capitalize(eventType.split(\".\")[1]);\n}\n\nexports.getFunctionsEventProvider = getFunctionsEventProvider;\n\nfunction promiseAllSettled(promises) {\n  const wrappedPromises = _.map(promises, async p => {\n    try {\n      const val = await Promise.resolve(p);\n      return {\n        state: \"fulfilled\",\n        value: val\n      };\n    } catch (err) {\n      return {\n        state: \"rejected\",\n        reason: err\n      };\n    }\n  });\n\n  return Promise.all(wrappedPromises);\n}\n\nexports.promiseAllSettled = promiseAllSettled;\n\nasync function promiseWhile(action, check, interval = 2500) {\n  return new Promise((resolve, promiseReject) => {\n    const run = async () => {\n      try {\n        const res = await action();\n\n        if (check(res)) {\n          return resolve(res);\n        }\n\n        setTimeout(run, interval);\n      } catch (err) {\n        return promiseReject(err);\n      }\n    };\n\n    run();\n  });\n}\n\nexports.promiseWhile = promiseWhile;\n\nasync function promiseProps(obj) {\n  const resultObj = {};\n\n  const promises = _.keys(obj).map(async key => {\n    const r = await Promise.resolve(obj[key]);\n    resultObj[key] = r;\n  });\n\n  return Promise.all(promises).then(() => resultObj);\n}\n\nexports.promiseProps = promiseProps;\n\nfunction tryStringify(value) {\n  if (typeof value === \"string\") {\n    return value;\n  }\n\n  try {\n    return JSON.stringify(value);\n  } catch (_a) {\n    return value;\n  }\n}\n\nexports.tryStringify = tryStringify;\n\nfunction tryParse(value) {\n  if (typeof value !== \"string\") {\n    return value;\n  }\n\n  try {\n    return JSON.parse(value);\n  } catch (_a) {\n    return value;\n  }\n}\n\nexports.tryParse = tryParse;\n\nfunction setupLoggers() {\n  if (process.env.DEBUG) {\n    logger_1.logger.add(new winston.transports.Console({\n      level: \"debug\",\n      format: winston.format.printf(info => {\n        const segments = [info.message, ...(info[triple_beam_1.SPLAT] || [])].map(tryStringify);\n        return `${ansiStrip(segments.join(\" \"))}`;\n      })\n    }));\n  } else if (process.env.IS_FIREBASE_CLI) {\n    logger_1.logger.add(new winston.transports.Console({\n      level: \"info\",\n      format: winston.format.printf(info => [info.message, ...(info[triple_beam_1.SPLAT] || [])].filter(chunk => typeof chunk == \"string\").join(\" \"))\n    }));\n  }\n}\n\nexports.setupLoggers = setupLoggers;\n\nasync function promiseWithSpinner(action, message) {\n  const spinner = ora(message).start();\n  let data;\n\n  try {\n    data = await action();\n    spinner.succeed();\n  } catch (err) {\n    spinner.fail();\n    throw err;\n  }\n\n  return data;\n}\n\nexports.promiseWithSpinner = promiseWithSpinner;\n\nfunction createDestroyer(server) {\n  const connections = new Set();\n  server.on(\"connection\", conn => {\n    connections.add(conn);\n    conn.once(\"close\", () => connections.delete(conn));\n  });\n  let destroyPromise = undefined;\n  return function destroyer() {\n    if (!destroyPromise) {\n      destroyPromise = new Promise((resolve, reject) => {\n        server.close(err => {\n          if (err) return reject(err);\n          resolve();\n        });\n        connections.forEach(socket => socket.destroy());\n      });\n    }\n\n    return destroyPromise;\n  };\n}\n\nexports.createDestroyer = createDestroyer;\n\nfunction datetimeString(d) {\n  const day = `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, \"0\")}-${d.getDate().toString().padStart(2, \"0\")}`;\n  const time = `${d.getHours().toString().padStart(2, \"0\")}:${d.getMinutes().toString().padStart(2, \"0\")}:${d.getSeconds().toString().padStart(2, \"0\")}`;\n  return `${day} ${time}`;\n}\n\nexports.datetimeString = datetimeString;\n\nfunction isCloudEnvironment() {\n  return !!process.env.CODESPACES;\n}\n\nexports.isCloudEnvironment = isCloudEnvironment;\n\nfunction isRunningInWSL() {\n  return !!process.env.WSL_DISTRO_NAME;\n}\n\nexports.isRunningInWSL = isRunningInWSL;\n\nfunction thirtyDaysFromNow() {\n  return new Date(Date.now() + THIRTY_DAYS_IN_MILLISECONDS);\n}\n\nexports.thirtyDaysFromNow = thirtyDaysFromNow;\n\nfunction assertDefined(val, message) {\n  if (val === undefined || val === null) {\n    throw new assert_1.AssertionError({\n      message: message || `expected value to be defined but got \"${val}\"`\n    });\n  }\n}\n\nexports.assertDefined = assertDefined;\n\nfunction assertIsString(val, message) {\n  if (typeof val !== \"string\") {\n    throw new assert_1.AssertionError({\n      message: message || `expected \"string\" but got \"${typeof val}\"`\n    });\n  }\n}\n\nexports.assertIsString = assertIsString;\n\nfunction assertIsNumber(val, message) {\n  if (typeof val !== \"number\") {\n    throw new assert_1.AssertionError({\n      message: message || `expected \"number\" but got \"${typeof val}\"`\n    });\n  }\n}\n\nexports.assertIsNumber = assertIsNumber;\n\nfunction assertIsStringOrUndefined(val, message) {\n  if (!(val === undefined || typeof val === \"string\")) {\n    throw new assert_1.AssertionError({\n      message: message || `expected \"string\" or \"undefined\" but got \"${typeof val}\"`\n    });\n  }\n}\n\nexports.assertIsStringOrUndefined = assertIsStringOrUndefined;","map":{"version":3,"sources":["C:/Users/Sharik/Desktop/Projects/ReactProject/my-first-app/node_modules/firebase-tools/lib/utils.js"],"names":["Object","defineProperty","exports","value","assertIsStringOrUndefined","assertIsNumber","assertIsString","assertDefined","thirtyDaysFromNow","isRunningInWSL","isCloudEnvironment","datetimeString","createDestroyer","promiseWithSpinner","setupLoggers","tryParse","tryStringify","promiseProps","promiseWhile","promiseAllSettled","getFunctionsEventProvider","endpoint","makeActiveProject","streamToString","stringToStream","explainStdin","allSettled","reject","logLabeledWarning","logWarning","logLabeledBullet","logBullet","logLabeledSuccess","logSuccess","addSubdomain","addDatabaseNamespace","getDatabaseViewDataUrl","getDatabaseUrl","envOverride","getInheritedOption","consoleUrl","envOverrides","_","require","url","clc","ora","process","stream_1","winston","triple_beam_1","assert_1","ansiStrip","configstore_1","error_1","logger_1","IS_WINDOWS","platform","SUCCESS_CHAR","WARNING_CHAR","THIRTY_DAYS_IN_MILLISECONDS","project","path","api","consoleOrigin","options","key","target","has","parent","envname","coerce","currentEnvValue","env","length","push","e","origin","namespace","pathname","withPath","resolve","urlObj","URL","hostname","includes","href","searchParams","set","subdomain","replace","message","type","data","undefined","logger","green","bold","label","cyan","yellow","Promise","FirebaseError","promises","remaining","results","i","then","result","status","err","reason","exit","stdin","isTTY","info","text","s","Readable","b","on","d","once","projectDir","newActive","activeProjects","configstore","get","unset","parts","join","eventType","split","provider","last","capitalize","match","wrappedPromises","map","p","val","state","all","action","check","interval","promiseReject","run","res","setTimeout","obj","resultObj","keys","r","JSON","stringify","_a","parse","DEBUG","add","transports","Console","level","format","printf","segments","SPLAT","IS_FIREBASE_CLI","filter","chunk","spinner","start","succeed","fail","server","connections","Set","conn","delete","destroyPromise","destroyer","close","forEach","socket","destroy","day","getFullYear","getMonth","toString","padStart","getDate","time","getHours","getMinutes","getSeconds","CODESPACES","WSL_DISTRO_NAME","Date","now","AssertionError"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.assertIsStringOrUndefined = exports.assertIsNumber = exports.assertIsString = exports.assertDefined = exports.thirtyDaysFromNow = exports.isRunningInWSL = exports.isCloudEnvironment = exports.datetimeString = exports.createDestroyer = exports.promiseWithSpinner = exports.setupLoggers = exports.tryParse = exports.tryStringify = exports.promiseProps = exports.promiseWhile = exports.promiseAllSettled = exports.getFunctionsEventProvider = exports.endpoint = exports.makeActiveProject = exports.streamToString = exports.stringToStream = exports.explainStdin = exports.allSettled = exports.reject = exports.logLabeledWarning = exports.logWarning = exports.logLabeledBullet = exports.logBullet = exports.logLabeledSuccess = exports.logSuccess = exports.addSubdomain = exports.addDatabaseNamespace = exports.getDatabaseViewDataUrl = exports.getDatabaseUrl = exports.envOverride = exports.getInheritedOption = exports.consoleUrl = exports.envOverrides = void 0;\nconst _ = require(\"lodash\");\nconst url = require(\"url\");\nconst clc = require(\"cli-color\");\nconst ora = require(\"ora\");\nconst process = require(\"process\");\nconst stream_1 = require(\"stream\");\nconst winston = require(\"winston\");\nconst triple_beam_1 = require(\"triple-beam\");\nconst assert_1 = require(\"assert\");\nconst ansiStrip = require(\"cli-color/strip\");\nconst configstore_1 = require(\"./configstore\");\nconst error_1 = require(\"./error\");\nconst logger_1 = require(\"./logger\");\nconst IS_WINDOWS = process.platform === \"win32\";\nconst SUCCESS_CHAR = IS_WINDOWS ? \"+\" : \"✔\";\nconst WARNING_CHAR = IS_WINDOWS ? \"!\" : \"⚠\";\nconst THIRTY_DAYS_IN_MILLISECONDS = 30 * 24 * 60 * 60 * 1000;\nexports.envOverrides = [];\nfunction consoleUrl(project, path) {\n    const api = require(\"./api\");\n    return `${api.consoleOrigin}/project/${project}${path}`;\n}\nexports.consoleUrl = consoleUrl;\nfunction getInheritedOption(options, key) {\n    let target = options;\n    while (target) {\n        if (_.has(target, key)) {\n            return target[key];\n        }\n        target = target.parent;\n    }\n}\nexports.getInheritedOption = getInheritedOption;\nfunction envOverride(envname, value, coerce) {\n    const currentEnvValue = process.env[envname];\n    if (currentEnvValue && currentEnvValue.length) {\n        exports.envOverrides.push(envname);\n        if (coerce) {\n            try {\n                return coerce(currentEnvValue, value);\n            }\n            catch (e) {\n                return value;\n            }\n        }\n        return currentEnvValue;\n    }\n    return value;\n}\nexports.envOverride = envOverride;\nfunction getDatabaseUrl(origin, namespace, pathname) {\n    const withPath = url.resolve(origin, pathname);\n    return addDatabaseNamespace(withPath, namespace);\n}\nexports.getDatabaseUrl = getDatabaseUrl;\nfunction getDatabaseViewDataUrl(origin, project, namespace, pathname) {\n    const urlObj = new url.URL(origin);\n    if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n        return consoleUrl(project, `/database/${namespace}/data${pathname}`);\n    }\n    return getDatabaseUrl(origin, namespace, pathname + \".json\");\n}\nexports.getDatabaseViewDataUrl = getDatabaseViewDataUrl;\nfunction addDatabaseNamespace(origin, namespace) {\n    const urlObj = new url.URL(origin);\n    if (urlObj.hostname.includes(namespace)) {\n        return urlObj.href;\n    }\n    if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n        return addSubdomain(origin, namespace);\n    }\n    urlObj.searchParams.set(\"ns\", namespace);\n    return urlObj.href;\n}\nexports.addDatabaseNamespace = addDatabaseNamespace;\nfunction addSubdomain(origin, subdomain) {\n    return origin.replace(\"//\", `//${subdomain}.`);\n}\nexports.addSubdomain = addSubdomain;\nfunction logSuccess(message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR} `), message, data);\n}\nexports.logSuccess = logSuccess;\nfunction logLabeledSuccess(label, message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR}  ${label}:`), message, data);\n}\nexports.logLabeledSuccess = logLabeledSuccess;\nfunction logBullet(message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.cyan.bold(\"i \"), message, data);\n}\nexports.logBullet = logBullet;\nfunction logLabeledBullet(label, message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.cyan.bold(`i  ${label}:`), message, data);\n}\nexports.logLabeledBullet = logLabeledBullet;\nfunction logWarning(message, type = \"warn\", data = undefined) {\n    logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR} `), message, data);\n}\nexports.logWarning = logWarning;\nfunction logLabeledWarning(label, message, type = \"warn\", data = undefined) {\n    logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR}  ${label}:`), message, data);\n}\nexports.logLabeledWarning = logLabeledWarning;\nfunction reject(message, options) {\n    return Promise.reject(new error_1.FirebaseError(message, options));\n}\nexports.reject = reject;\nfunction allSettled(promises) {\n    if (!promises.length) {\n        return Promise.resolve([]);\n    }\n    return new Promise((resolve) => {\n        let remaining = promises.length;\n        const results = [];\n        for (let i = 0; i < promises.length; i++) {\n            void Promise.resolve(promises[i])\n                .then((result) => {\n                results[i] = {\n                    status: \"fulfilled\",\n                    value: result,\n                };\n            }, (err) => {\n                results[i] = {\n                    status: \"rejected\",\n                    reason: err,\n                };\n            })\n                .then(() => {\n                if (!--remaining) {\n                    resolve(results);\n                }\n            });\n        }\n    });\n}\nexports.allSettled = allSettled;\nfunction explainStdin() {\n    if (IS_WINDOWS) {\n        throw new error_1.FirebaseError(\"STDIN input is not available on Windows.\", {\n            exit: 1,\n        });\n    }\n    if (process.stdin.isTTY) {\n        logger_1.logger.info(clc.bold(\"Note:\"), \"Reading STDIN. Type JSON data and then press Ctrl-D\");\n    }\n}\nexports.explainStdin = explainStdin;\nfunction stringToStream(text) {\n    if (!text) {\n        return undefined;\n    }\n    const s = new stream_1.Readable();\n    s.push(text);\n    s.push(null);\n    return s;\n}\nexports.stringToStream = stringToStream;\nfunction streamToString(s) {\n    return new Promise((resolve, reject) => {\n        let b = \"\";\n        s.on(\"error\", reject);\n        s.on(\"data\", (d) => (b += `${d}`));\n        s.once(\"end\", () => resolve(b));\n    });\n}\nexports.streamToString = streamToString;\nfunction makeActiveProject(projectDir, newActive) {\n    const activeProjects = configstore_1.configstore.get(\"activeProjects\") || {};\n    if (newActive) {\n        activeProjects[projectDir] = newActive;\n    }\n    else {\n        _.unset(activeProjects, projectDir);\n    }\n    configstore_1.configstore.set(\"activeProjects\", activeProjects);\n}\nexports.makeActiveProject = makeActiveProject;\nfunction endpoint(parts) {\n    return `/${_.join(parts, \"/\")}`;\n}\nexports.endpoint = endpoint;\nfunction getFunctionsEventProvider(eventType) {\n    const parts = eventType.split(\"/\");\n    if (parts.length > 1) {\n        const provider = _.last(parts[1].split(\".\"));\n        return _.capitalize(provider);\n    }\n    if (eventType.match(/google.pubsub/)) {\n        return \"PubSub\";\n    }\n    else if (eventType.match(/google.storage/)) {\n        return \"Storage\";\n    }\n    else if (eventType.match(/google.analytics/)) {\n        return \"Analytics\";\n    }\n    else if (eventType.match(/google.firebase.database/)) {\n        return \"Database\";\n    }\n    else if (eventType.match(/google.firebase.auth/)) {\n        return \"Auth\";\n    }\n    else if (eventType.match(/google.firebase.crashlytics/)) {\n        return \"Crashlytics\";\n    }\n    else if (eventType.match(/google.firestore/)) {\n        return \"Firestore\";\n    }\n    return _.capitalize(eventType.split(\".\")[1]);\n}\nexports.getFunctionsEventProvider = getFunctionsEventProvider;\nfunction promiseAllSettled(promises) {\n    const wrappedPromises = _.map(promises, async (p) => {\n        try {\n            const val = await Promise.resolve(p);\n            return { state: \"fulfilled\", value: val };\n        }\n        catch (err) {\n            return { state: \"rejected\", reason: err };\n        }\n    });\n    return Promise.all(wrappedPromises);\n}\nexports.promiseAllSettled = promiseAllSettled;\nasync function promiseWhile(action, check, interval = 2500) {\n    return new Promise((resolve, promiseReject) => {\n        const run = async () => {\n            try {\n                const res = await action();\n                if (check(res)) {\n                    return resolve(res);\n                }\n                setTimeout(run, interval);\n            }\n            catch (err) {\n                return promiseReject(err);\n            }\n        };\n        run();\n    });\n}\nexports.promiseWhile = promiseWhile;\nasync function promiseProps(obj) {\n    const resultObj = {};\n    const promises = _.keys(obj).map(async (key) => {\n        const r = await Promise.resolve(obj[key]);\n        resultObj[key] = r;\n    });\n    return Promise.all(promises).then(() => resultObj);\n}\nexports.promiseProps = promiseProps;\nfunction tryStringify(value) {\n    if (typeof value === \"string\") {\n        return value;\n    }\n    try {\n        return JSON.stringify(value);\n    }\n    catch (_a) {\n        return value;\n    }\n}\nexports.tryStringify = tryStringify;\nfunction tryParse(value) {\n    if (typeof value !== \"string\") {\n        return value;\n    }\n    try {\n        return JSON.parse(value);\n    }\n    catch (_a) {\n        return value;\n    }\n}\nexports.tryParse = tryParse;\nfunction setupLoggers() {\n    if (process.env.DEBUG) {\n        logger_1.logger.add(new winston.transports.Console({\n            level: \"debug\",\n            format: winston.format.printf((info) => {\n                const segments = [info.message, ...(info[triple_beam_1.SPLAT] || [])].map(tryStringify);\n                return `${ansiStrip(segments.join(\" \"))}`;\n            }),\n        }));\n    }\n    else if (process.env.IS_FIREBASE_CLI) {\n        logger_1.logger.add(new winston.transports.Console({\n            level: \"info\",\n            format: winston.format.printf((info) => [info.message, ...(info[triple_beam_1.SPLAT] || [])]\n                .filter((chunk) => typeof chunk == \"string\")\n                .join(\" \")),\n        }));\n    }\n}\nexports.setupLoggers = setupLoggers;\nasync function promiseWithSpinner(action, message) {\n    const spinner = ora(message).start();\n    let data;\n    try {\n        data = await action();\n        spinner.succeed();\n    }\n    catch (err) {\n        spinner.fail();\n        throw err;\n    }\n    return data;\n}\nexports.promiseWithSpinner = promiseWithSpinner;\nfunction createDestroyer(server) {\n    const connections = new Set();\n    server.on(\"connection\", (conn) => {\n        connections.add(conn);\n        conn.once(\"close\", () => connections.delete(conn));\n    });\n    let destroyPromise = undefined;\n    return function destroyer() {\n        if (!destroyPromise) {\n            destroyPromise = new Promise((resolve, reject) => {\n                server.close((err) => {\n                    if (err)\n                        return reject(err);\n                    resolve();\n                });\n                connections.forEach((socket) => socket.destroy());\n            });\n        }\n        return destroyPromise;\n    };\n}\nexports.createDestroyer = createDestroyer;\nfunction datetimeString(d) {\n    const day = `${d.getFullYear()}-${(d.getMonth() + 1)\n        .toString()\n        .padStart(2, \"0\")}-${d.getDate().toString().padStart(2, \"0\")}`;\n    const time = `${d.getHours().toString().padStart(2, \"0\")}:${d\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\")}:${d.getSeconds().toString().padStart(2, \"0\")}`;\n    return `${day} ${time}`;\n}\nexports.datetimeString = datetimeString;\nfunction isCloudEnvironment() {\n    return !!process.env.CODESPACES;\n}\nexports.isCloudEnvironment = isCloudEnvironment;\nfunction isRunningInWSL() {\n    return !!process.env.WSL_DISTRO_NAME;\n}\nexports.isRunningInWSL = isRunningInWSL;\nfunction thirtyDaysFromNow() {\n    return new Date(Date.now() + THIRTY_DAYS_IN_MILLISECONDS);\n}\nexports.thirtyDaysFromNow = thirtyDaysFromNow;\nfunction assertDefined(val, message) {\n    if (val === undefined || val === null) {\n        throw new assert_1.AssertionError({\n            message: message || `expected value to be defined but got \"${val}\"`,\n        });\n    }\n}\nexports.assertDefined = assertDefined;\nfunction assertIsString(val, message) {\n    if (typeof val !== \"string\") {\n        throw new assert_1.AssertionError({\n            message: message || `expected \"string\" but got \"${typeof val}\"`,\n        });\n    }\n}\nexports.assertIsString = assertIsString;\nfunction assertIsNumber(val, message) {\n    if (typeof val !== \"number\") {\n        throw new assert_1.AssertionError({\n            message: message || `expected \"number\" but got \"${typeof val}\"`,\n        });\n    }\n}\nexports.assertIsNumber = assertIsNumber;\nfunction assertIsStringOrUndefined(val, message) {\n    if (!(val === undefined || typeof val === \"string\")) {\n        throw new assert_1.AssertionError({\n            message: message || `expected \"string\" or \"undefined\" but got \"${typeof val}\"`,\n        });\n    }\n}\nexports.assertIsStringOrUndefined = assertIsStringOrUndefined;\n"]},"metadata":{},"sourceType":"script"}